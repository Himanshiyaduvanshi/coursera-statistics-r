---
title: "Statistical inference with the GSS data"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
library(statsr)

library(janitor)
library(tidyr)
library(wesanderson)
library(skimr)
```

### Load data

Make sure your data and R Markdown files are in the same directory. When loaded
your data file will be called `gss`. Delete this note when before you submit 
your work. 

```{r load-data}
load("gss.Rdata")
```

* * *

## Part 1: Data

**Generalizability**

The survey data is collected through random sampling with different sampling methods like block quota sampling and full probability sampling. The sample size is less than 10% of the Unitied States population. Hence, the samples are considered independent of each other. Non-respondents are also sub-sampled since 2004, non-response bias is minimalized.

However, only English-speaking persons 18 years of age or over non-institutional arrangements within the United States are sampled from 1972 to 2004. Spanish-speakers were added to the target population since 2006. With non-English (and Spanish) speakers and institutional population excluded, inference within cannot be generalized to the entire United States population, but only the target population.

**Causality**

Inference of a causal connection can only be done through experiment with random assignment. There is no evidence that random assignment is used with reference to the survey method. Hence, the data is not applicable to causal inference.

* * *

## Part 2: Research question

In 1955, homosexual sex was illegal and homosexuality was understood by psychiatrists to be a mental illness. In 2008, Phyllis and Del were married by San Francisco Mayor Gavin Newsom. Celebrating the newly established right of same-sex marriage, they were the first lesbian couple to marry in San Francisco. There has been a slow and hard-fought battle for the public and legal acceptance of homosexuality. 

**Does the GSS data provide evidence that the proportion of American population accepting homosexuality changes over time?** 

* * *

## Part 3: Exploratory data analysis

```{r}
data <- gss %>% select(year, homosex, degree) 
```

The variable `homosex` contains the answer for the question "What about sexual relations between two adults of the same sex?" The available options are listed below:

1.	ALWAYS WRONG
2.	ALMST ALWAYS WRG
3.	SOMETIMES WRONG
4.	NOT WRONG AT ALL
5.	OTHER

Except for the option "NOT WRONG AT ALL", other choices still represent some degrees of bias towards homosexuality. Hence, we consider "NOT WRONG AT ALL" the success condition: acceting homosexuality; and the all others the failure condition: not accepting homosexuality.

```{r}
data %>% 
  filter(!is.na(homosex)) %>% 
  mutate(homosex = ifelse(homosex == "Not Wrong At All", "accept_homosex", "not_accept_homosex")) %>% 
  tabyl(year, homosex) %>% 
  adorn_percentages() %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>% 
  kable()
```

The summary statistics calculated the the proportion of people accepting and not accepting homosexuality by survey year. It shows that the proportion of people accepting homosexuality increases gradually overtime. 

```{r}
data %>% 
  filter(!is.na(homosex)) %>% 
  tabyl(year, homosex) %>%
  adorn_percentages() %>%
  gather(key, value, -year) %>% 
  mutate(
    year = factor(year, ordered = TRUE),
    key = factor(
      key, 
      levels = c(
        "Always Wrong", "Almst Always Wrg", "Sometimes Wrong", "Other", "Not Wrong At All"
      ),
      ordered = TRUE
    )) %>% 
  ggplot() + geom_col(aes(x=year,y=value,fill=key)) +
  theme_minimal() +
  theme(legend.position = "bottom", axis.text.x = element_text(angle = 90)) +
  scale_fill_manual(values = wes_palette("Royal2", 5)) +
  labs(x = "Year", y = "Proportion", fill = "Attitude") +
  ggtitle("Attitude towards Homosexualiy in GSS Data")
```

The proportion of people's response on the topic of homosexuality is shown in detail in this plot. The plot also showed an increasing trend of people accepting homosexuality overtime. It is interesting to note that there is a proportion of people having an in-between / uncertain attitude towards homosexuality - "ALMST ALWAYS WRG" and "SOMETIMES WRONG" - and that proportion of people seems not changing at all.

Referencing to our research topic, we would like to perform statistical inference to examine whether there are more people accepting homosexuality in 2012 than in 1973. Hence we simiplify our exploration to only the year 1973 and 2012.

```{r}
data <- data %>% 
  filter(!is.na(homosex)) %>% 
  mutate(homosex = ifelse(homosex == "Not Wrong At All", "accept_homosex", "not_accept_homosex")) %>% 
  filter(year %in% c('1973', '2012'))
```

```{r}
data %>% 
  filter(!is.na(homosex)) %>% 
  tabyl(year, homosex) %>% 
  adorn_percentages() %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>% 
  kable()
```

```{r}
data %>% 
  tabyl(year, homosex) %>%
  adorn_percentages() %>%
  gather(key, value, -year) %>% 
    mutate(
    year = as.factor(year),
    key = factor(
      key, 
      levels = c(
        "not_accept_homosex", "accept_homosex"
      ),
      ordered = TRUE
    )) %>% 
  ggplot(aes(x=year,y=value)) + geom_col(aes(fill=key)) +
  theme_minimal() +
  theme(legend.position = "bottom", axis.text.x = element_text(angle = 90)) +
  scale_fill_manual(values = wes_palette("Royal2", 5), labels = c("Not Accept Homosexuality", "Accept Homosexuality")) +
  labs(x = "Year", y = "Proportion", fill = "Attitude") +
  ggtitle("Attitude towards Homosexualiy in GSS Data")
```

Both the summry table and the plot above showed a difference between the proportion of people accepting homosexuality in 1973 (11%) and 2012 (44.6%).

* * *

## Part 4: Inference

To perform statistical inference to examine whether there are more people accepting homosexuality in 2012 than in 1973, we first determine the method to be used. Since our sample size is large enough, we will perform theoretical-based inference - confidence interval and hypothesis test.

**Confidence Interval**

Before computing 

```{r}
data %>% 
  group_by(year) %>% 
  summarise(n = n()) %>% 
  kable()
```

First we check the independence condition. We learnt earlier that the GSS data are collected through random sampling. The sample size in 1973 and 2012 are 1448 and 1239 respectively - definitely smaller than 10% of the American population. Since our date come from two independent random samples, they are are independent within and between the two groups. The independence condition is satisfied.



**Hypothesis Test**

We conduct a hypothesis test to examine whether there are more people accepting homosexuality in 2012 than in 1973.



The null hypothesis states that the proportion of American population accepting homosexuality in 2012 is the same as that in 1973. The alternative hypothesis states that the proportion of American population accepting homosexuality in 2012 is greater than that in 1973.

$$
H_0: p_{2012} = p_{1973}\\
H_A: p_{2012} > p_{1973}
$$

Before doing inference, we need to check the conditions. 

```{r}
data %>% 
  group_by(year) %>% 
  summarise(n = n()) %>% 
  kable()
```

First we check the independence condition. We learnt earlier that the GSS data are collected through random sampling. The sample size in 1973 and 2012 are 1448 and 1239 respectively - definitely smaller than 10% of the American population. Since our date come from two independent random samples, they are are independent within and between the two groups. The independence condition is satisfied.

```{r}
data %>% 
  tabyl(year, homosex) %>% 
  kable()
```

Secondly we check the success-failure condition. The success-failure condition expect to see at least 10 success and 10 failure in the sample and in our sample the condition holds for both groups. The success-failure condition is also met.


